<!--
    ***********************************************************************************
    
    Extended WPF Toolkit
    
    Copyright (C) 2007-2013 Xceed Software Inc.
    
    This program is provided to you under the terms of the Microsoft Public
    License (Ms-PL) as published at http://wpftoolkit.codeplex.com/license
    
    For more features, controls, and fast professional support,
    pick up the Plus Edition at http://xceed.com/wpf_toolkit
    
    Stay informed: follow @datagrid on Twitter or Like http://facebook.com/datagrids
    
    **********************************************************************************
-->

<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:h="https://github.com/HeBianGu"
                    xmlns:local="clr-namespace:H.Controls.ZoomBox">

    <local:RoundedValueConverter x:Key="RoundedValueConverter"
                                 Precision="2" />
    <local:VisibilityToBoolConverter x:Key="TrueIfVisibleConverter"
                                     Inverted="False"
                                     Not="False" />
    <local:VisibilityToBoolConverter x:Key="TrueIfNotVisibleConverter"
                                     Inverted="False"
                                     Not="True" />
    <local:VisibilityToBoolConverter x:Key="VisibleIfTrueConverter"
                                     Inverted="True"
                                     Not="False" />
    <local:VisibilityToBoolConverter x:Key="VisibleIfNotTrueConverter"
                                     Inverted="True"
                                     Not="True" />

    <SolidColorBrush x:Key="GlyphBrush"
                     Color="white" />

    <Style x:Key="TransparentButton"
           BasedOn="{x:Null}"
           TargetType="{x:Type ButtonBase}">
        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        <Setter Property="Background" Value="#333333" />
        <Setter Property="Foreground" Value="#cccccc" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ButtonBase}">
                    <Grid Background="Transparent"
                          Cursor="Hand">
                        <Rectangle x:Name="BackgroundTextBoxRectangle"
                                   Fill="{TemplateBinding Background}"
                                   Opacity="0"
                                   RadiusX="3"
                                   RadiusY="3"
                                   Stroke="{TemplateBinding Foreground}" />
                        <ContentPresenter />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Opacity" Value="0.4" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="BackgroundTextBoxRectangle" Property="Opacity" Value="1" />
                        </Trigger>
                        <Trigger Property="IsKeyboardFocusWithin" Value="True">
                            <Setter TargetName="BackgroundTextBoxRectangle" Property="Opacity" Value="1" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="{x:Type local:Zoombox}"
           TargetType="{x:Type local:Zoombox}">
        <!--<Setter Property="Background" Value="Transparent" />-->
        <Setter Property="Background" Value="{DynamicResource {x:Static BrushKeys.Tile}}" />
        <Setter Property="Foreground" Value="{DynamicResource {x:Static BrushKeys.Foreground}}" />
        <Setter Property="BorderBrush" Value="{DynamicResource {x:Static BrushKeys.BorderBrush}}" />
        <Setter Property="PanDistance" Value="5.0" />
        <Setter Property="ZoomOrigin" Value="0.5,0.5" />
        <Setter Property="ZoomPercentage" Value="5.0" />
        <Setter Property="DragModifiers" Value="Ctrl,Exact" />
        <Setter Property="DragOnPreview" Value="False" />
        <Setter Property="ZoomModifiers" Value="Shift,Exact" />
        <Setter Property="ZoomOnPreview" Value="True" />
        <Setter Property="RelativeZoomModifiers" Value="Ctrl,Alt,Exact" />
        <Setter Property="ZoomToSelectionModifiers" Value="Alt,Exact" />
        <Setter Property="NavigateOnPreview" Value="False" />
        <Setter Property="ViewFinderVisibility" Value="Collapsed" />
        <Setter Property="MinScale" Value="0.1" />
        <Setter Property="MaxScale" Value="100.0" />
        <Setter Property="Focusable" Value="False" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:Zoombox}">
                    <ControlTemplate.Resources>
                        <SolidColorBrush x:Key="SelectionBrush"
                                         Color="Transparent" />
                        <Pen x:Key="SelectionPen"
                             Brush="#7F3F3F3F"
                             Thickness="2.0" />
                        <Pen x:Key="ViewportPen"
                             Brush="Black"
                             Thickness="1.0" />
                        <InputBindingCollection x:Key="InputBindings">
                            <KeyBinding Key="Left"
                                        Command="local:Zoombox.ZoomOut"
                                        Modifiers="Control" />
                            <KeyBinding Key="Up"
                                        Command="local:Zoombox.ZoomOut"
                                        Modifiers="Control" />
                            <KeyBinding Key="Right"
                                        Command="local:Zoombox.ZoomIn"
                                        Modifiers="Control" />
                            <KeyBinding Key="Down"
                                        Command="local:Zoombox.ZoomIn"
                                        Modifiers="Control" />
                            <KeyBinding Key="Left"
                                        Command="local:Zoombox.PanLeft"
                                        Modifiers="Shift+Control" />
                            <KeyBinding Key="Up"
                                        Command="local:Zoombox.PanUp"
                                        Modifiers="Shift+Control" />
                            <KeyBinding Key="Right"
                                        Command="local:Zoombox.PanRight"
                                        Modifiers="Shift+Control" />
                            <KeyBinding Key="Down"
                                        Command="local:Zoombox.PanDown"
                                        Modifiers="Shift+Control" />
                            <KeyBinding Key="BrowserForward"
                                        Command="local:Zoombox.Forward" />
                            <KeyBinding Key="BrowserBack"
                                        Command="local:Zoombox.Back" />
                            <KeyBinding Key="Back"
                                        Command="local:Zoombox.Back" />
                        </InputBindingCollection>
                    </ControlTemplate.Resources>
                    <Grid Name="BackgroundGrid"
                          Background="{TemplateBinding Background}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ContentPresenter x:Name="_contentPresenter"
                                          Grid.Row="0"
                                          Grid.Column="0" />
                        <ScrollBar x:Name="PART_VerticalScrollBar"
                                   Grid.Row="0"
                                   Grid.Column="1"
                                   Orientation="Vertical"
                                   Visibility="Collapsed" />
                        <ScrollBar x:Name="PART_HorizontalScrollBar"
                                   Grid.Row="1"
                                   Grid.Column="0"
                                   Orientation="Horizontal"
                                   Visibility="Collapsed" />
                        <Border Grid.Row="1"
                                Grid.Column="1"
                                Background="{DynamicResource {x:Static h:BrushKeys.Background}}" />

                        <Border Name="ViewFinder"
                                Height="190"
                                Margin="10"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="2"
                                Opacity="0"
                                RenderTransformOrigin="1,1">
                            <Border.Background>
                                <SolidColorBrush Opacity="0.6"
                                                 Color="{DynamicResource {x:Static ColorKeys.CaptionBackground}}" />
                            </Border.Background>
                            <Border.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="LayoutScaleTransform" ScaleX="0" ScaleY="0" />
                                </TransformGroup>
                            </Border.RenderTransform>
                            <Grid Margin="4">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <FontIconButton x:Name="BackButton"
                                                    Command="local:Zoombox.Back"
                                                    Content="{x:Static FontIcons.Back}" />
                                    <FontIconButton x:Name="ForwardButton"
                                                    Command="local:Zoombox.Forward"
                                                    Content="{x:Static FontIcons.Forward}" />
                                    <FontIconButton x:Name="HomeButton"
                                                    Command="local:Zoombox.Home"
                                                    Content="{x:Static FontIcons.Home}" />
                                    <FontIconButton x:Name="FitButton"
                                                    Command="local:Zoombox.Fit"
                                                    Content="{x:Static FontIcons.FitPage}" />
                                    <FontIconButton x:Name="FillButton"
                                                    Command="local:Zoombox.Fill"
                                                    Content="{x:Static FontIcons.FullScreen}" />
                                    <FontIconButton x:Name="CenterButton"
                                                    Command="local:Zoombox.Center"
                                                    Content="{x:Static FontIcons.PanMode}" />
                                    <FontIconButton x:Name="RefocusButton"
                                                    Command="local:Zoombox.Refocus"
                                                    Content="{x:Static FontIcons.Location}"
                                                    Visibility="Collapsed" />
                                    <FontIconToggleButton x:Name="ToggleViewFinderButton"
                                                          BorderThickness="0"
                                                          CheckedGlyph="{x:Static FontIcons.ChromeClose}"
                                                          IsChecked="{Binding ElementName=ShowViewFinder, Path=IsChecked}"
                                                          UncheckedGlyph="{x:Static FontIcons.ChromeClose}" />
                                </StackPanel>
                                <Border Grid.Row="1"
                                        Background="{DynamicResource {x:Static BrushKeys.CaptionBackground}}"
                                        Opacity="0.6" />
                                <local:ZoomboxViewFinderDisplay x:Name="ViewFinderDisplay"
                                                                Grid.Row="1"
                                                                Margin="2"
                                                                Background="{DynamicResource {x:Static BrushKeys.Background}}"
                                                                ClipToBounds="True"
                                                                ViewportBorderBrush="{DynamicResource {x:Static BrushKeys.Foreground}}"
                                                                ViewportBrush="Transparent">
                                    <local:ZoomboxViewFinderDisplay.ShadowBrush>
                                        <SolidColorBrush Opacity="0.2"
                                                         Color="Black" />
                                    </local:ZoomboxViewFinderDisplay.ShadowBrush>
                                </local:ZoomboxViewFinderDisplay>
                            </Grid>
                        </Border>
                        <Grid Name="ShowViewFinderGlyph"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Bottom"
                              Opacity="0"
                              Visibility="{Binding Path=UseShowViewFinder, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource VisibleIfTrueConverter}}">
                            <FontIconToggleButton Name="ShowViewFinder"
                                                  Margin="5"
                                                  HorizontalAlignment="Right"
                                                  VerticalAlignment="Bottom"
                                                  CheckedGlyph="&#xE741;"
                                                  IsChecked="{Binding Path=ViewFinderVisibility, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource TrueIfVisibleConverter}}"
                                                  IsTabStop="False"
                                                  ToolTip="显示/隐藏定位器"
                                                  UncheckedGlyph="&#xE1D9;">
                                <Control.Style>
                                    <Style BasedOn="{StaticResource {x:Static FontIconToggleButtonKeys.Default}}"
                                           TargetType="{x:Type FontIconToggleButton}">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type local:Zoombox}}, Path=ViewFinderVisibility}"
                                                         Value="Hidden">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Control.Style>
                                <!--<Grid Name="ShowViewFinderGlyph"
               Opacity="0">
             <Image x:Name="ShowViewFinderGlyphImage"
                    Source="{StaticResource ShowViewFinderGlyph}" />
         </Grid>-->
                            </FontIconToggleButton>
                        </Grid>

                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="EffectiveViewStackMode" Value="Manual">
                            <Setter TargetName="RefocusButton" Property="Visibility" Value="Visible" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation DecelerationRatio="1"
                                                         FillBehavior="HoldEnd"
                                                         Storyboard.TargetName="ShowViewFinderGlyph"
                                                         Storyboard.TargetProperty="Opacity"
                                                         From="0"
                                                         To="1"
                                                         Duration="0:0:0.3" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation DecelerationRatio="1"
                                                         FillBehavior="HoldEnd"
                                                         Storyboard.TargetName="ShowViewFinderGlyph"
                                                         Storyboard.TargetProperty="Opacity"
                                                         From="1"
                                                         To="0"
                                                         Duration="0:0:0.3" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                        <Trigger SourceName="ShowViewFinder" Property="IsChecked" Value="False">
                            <Setter TargetName="BackButton" Property="Focusable" Value="False" />
                            <Setter TargetName="ForwardButton" Property="Focusable" Value="False" />
                            <Setter TargetName="HomeButton" Property="Focusable" Value="False" />
                            <Setter TargetName="FitButton" Property="Focusable" Value="False" />
                            <Setter TargetName="FillButton" Property="Focusable" Value="False" />
                            <Setter TargetName="CenterButton" Property="Focusable" Value="False" />
                            <Setter TargetName="ToggleViewFinderButton" Property="Focusable" Value="False" />
                        </Trigger>
                        <Trigger Property="IsUsingScrollBars" Value="True">
                            <Setter TargetName="PART_VerticalScrollBar" Property="Visibility" Value="Visible" />
                            <Setter TargetName="PART_HorizontalScrollBar" Property="Visibility" Value="Visible" />
                        </Trigger>
                        <EventTrigger RoutedEvent="ToggleButton.Checked"
                                      SourceName="ShowViewFinder">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation DecelerationRatio="1"
                                                     FillBehavior="HoldEnd"
                                                     Storyboard.TargetName="ViewFinder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     From="0"
                                                     To="1"
                                                     Duration="0:0:0.3" />
                                    <DoubleAnimation DecelerationRatio="1"
                                                     FillBehavior="HoldEnd"
                                                     Storyboard.TargetName="ShowViewFinder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     From="1"
                                                     To="0"
                                                     Duration="0:0:0.3" />
                                    <DoubleAnimationUsingKeyFrames AccelerationRatio="1"
                                                                   BeginTime="00:00:00"
                                                                   Storyboard.TargetName="LayoutScaleTransform"
                                                                   Storyboard.TargetProperty="(ScaleTransform.ScaleY)">
                                        <SplineDoubleKeyFrame KeySpline="0.5,0.5,0.5,0.5"
                                                              KeyTime="00:00:00.3"
                                                              Value="1" />
                                    </DoubleAnimationUsingKeyFrames>
                                    <DoubleAnimationUsingKeyFrames AccelerationRatio="1"
                                                                   BeginTime="00:00:00"
                                                                   Storyboard.TargetName="LayoutScaleTransform"
                                                                   Storyboard.TargetProperty="(ScaleTransform.ScaleX)">
                                        <SplineDoubleKeyFrame KeySpline="0.5,0.5,0.5,0.5"
                                                              KeyTime="00:00:00.3"
                                                              Value="1" />
                                    </DoubleAnimationUsingKeyFrames>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                        <EventTrigger RoutedEvent="ToggleButton.Unchecked"
                                      SourceName="ShowViewFinder">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimationUsingKeyFrames AccelerationRatio="1"
                                                                   BeginTime="00:00:00"
                                                                   Storyboard.TargetName="LayoutScaleTransform"
                                                                   Storyboard.TargetProperty="(ScaleTransform.ScaleY)">
                                        <SplineDoubleKeyFrame KeySpline="0.5,0.5,0.5,0.5"
                                                              KeyTime="00:00:00.3"
                                                              Value="0" />
                                    </DoubleAnimationUsingKeyFrames>
                                    <DoubleAnimationUsingKeyFrames AccelerationRatio="1"
                                                                   BeginTime="00:00:00"
                                                                   Storyboard.TargetName="LayoutScaleTransform"
                                                                   Storyboard.TargetProperty="(ScaleTransform.ScaleX)">
                                        <SplineDoubleKeyFrame KeySpline="0.5,0.5,0.5,0.5"
                                                              KeyTime="00:00:00.3"
                                                              Value="0" />
                                    </DoubleAnimationUsingKeyFrames>
                                    <DoubleAnimation DecelerationRatio="1"
                                                     FillBehavior="HoldEnd"
                                                     Storyboard.TargetName="ViewFinder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     From="1"
                                                     To="0"
                                                     Duration="0:0:0.3" />
                                    <DoubleAnimation DecelerationRatio="1"
                                                     FillBehavior="HoldEnd"
                                                     Storyboard.TargetName="ShowViewFinder"
                                                     Storyboard.TargetProperty="Opacity"
                                                     From="0"
                                                     To="1"
                                                     Duration="0:0:0.3" />
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <!--
                NOTE:  Order matters!
                These triggers should be ordered according to the KeyModifiers assigned to
                each operation. If one operation requires Ctrl and another requires
                Ctrl+Shift, the trigger for the operation requiring both modifier keys
                should appear *after* the trigger for the operation requiring only one.
            -->
            <Trigger Property="AreDragModifiersActive" Value="True">
                <Setter Property="Cursor" Value="SizeAll" />
            </Trigger>
            <Trigger Property="AreZoomToSelectionModifiersActive" Value="True">
                <Setter Property="Cursor" Value="Cross" />
            </Trigger>
            <Trigger Property="AreZoomModifiersActive" Value="True">
                <!--<Setter Property="Cursor" Value="{x:Static local:ZoomboxCursors.Zoom}" />-->
                <Setter Property="Cursor" Value="Arrow" />
            </Trigger>
            <Trigger Property="AreRelativeZoomModifiersActive" Value="True">
                <Setter Property="Cursor" Value="Arrow" />
            </Trigger>
            <!--
                The IsDraggingContent and IsSelectingRegion triggers should
                always be last.
            -->
            <Trigger Property="IsDraggingContent" Value="True">
                <Setter Property="Cursor" Value="SizeAll" />
            </Trigger>
            <Trigger Property="IsSelectingRegion" Value="True">
                <Setter Property="Cursor" Value="Cross" />
            </Trigger>
        </Style.Triggers>
    </Style>
</ResourceDictionary>
